{% load panels %}
<div ng-controller="ResultView as resultView" class="col-md-12 lab-tests">
  <div class="panel panel-default">
    <div class="panel-heading">
      <div class="row">
        <div class="col-md-6">
          <h3>
            Lab Tests <i class="fa fa-flask"></i>
          </h3>
        </div>
        <div class="col-md-6 text-right">
          <div class="btn-group" uib-dropdown is-open="status.isopen">
            <button type="button" class="btn btn-secondary" uib-dropdown-toggle ng-disabled="disabled" id="list-dropdown">
              <i class="fa fa-user-md"></i>
                [[ resultView.currentTag ]]
              <i class="fa fa-angle-down"></i>
            </button>
            <ul class="uib-dropdown-menu slides" role="menu" aria-labelledby="list-dropdown">
              <li ng-show="tag !== resultView.currentTag" ng-repeat="tag in resultView.tags">
                <a href="#">
                  [[ tag ]]
                </a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <ul class="list-group">
      <li class="list-group-item" ng-repeat="labTest in resultView.labTests">
        <div class="row">
          <div class="col-md-6">
            <h5>[[ labTest.lab_test_type ]]</h5>
          </div>
          <div class="text-right col-md-6">
            <span ng-repeat="tag in labTest.tags">
              <a class="btn btn-default pointer btn-sm" href="/#/">[[ tag ]]</a>
            </span>
          </div>
        </div>
        <table class="table" ng-show="labTest.observations.length">
          <thead>
            <tr>
              <td></td>
              <td></td>
              <td>Range</td>
              <td ng-repeat="obsDate in labTest.observation_date_range track by $index">
                [[ obsDate|shortDate ]]
              </td>
            </th>
          </thead>
          <tbody>
            <tr ng-repeat="observation_name in labTest.observation_names">
              <td>
                [[ observation_name ]]
                <span ng-show="labTest.observation_metadata[observation_name].units && labTest.observation_metadata[observation_name].units.length">
                  ([[ labTest.observation_metadata[observation_name].units ]])
                </span>
              </td>
              <td>
                <div investigation-graph="labTest.observation_time_series[observation_name]"></div>
              </td>
              <td>
                <span ng-show="labTest.observation_metadata[observation_name].reference_range">
                  [[ labTest.observation_metadata[observation_name].reference_range.min ]]
                  -
                  [[ labTest.observation_metadata[observation_name].reference_range.max ]]
                </span>
              </td>
              <td ng-class="{'too-high': labTest.by_observations[observation_name][obsDate].observation_value > labTest.observation_metadata[observation_name].reference_range.max, 'too-low': labTest.by_observations[observation_name][obsDate].observation_value < labTest.observation_metadata[observation_name].reference_range.min}" ng-repeat="obsDate in labTest.observation_date_range track by $index">
                [[ labTest.by_observations[observation_name][obsDate].observation_value ]]
              </td>
            </tr>
          </tbody>
        </table>
      </li>
    </ul>
  </div>
</div>
