{% load panels %}
<div ng-controller="ResultView as resultView" class="col-md-12">
  <div class="panel panel-default">
    <div class="panel-heading">
      <div class="row">
        <div class="col-md-6">
          <h3>
            Lab Tests <i class="fa fa-flask"></i>
          </h3>
        </div>
        <div class="col-md-6 text-right">
          <div class="form-inline">
            <input placeholder="Filter" ng-change="resultView.filterRows()" class="form-control" id="filterValue" type="text" ng-model="resultView.filterValue">
          </div>
        </div>
      </div>
    </div>
    <ul class="list-group">
      <li class="list-group-item" ng-repeat="labTest in resultView.labTests">
        <div class="row">
          <div class="col-md-12">
            <h5>[[ labTest.lab_test_type ]]</h5>
          </div>
        </div>
        <div ng-repeat="observation in labTest.observations" class="row" ng-class="{'content-offset-25': $index && labTest.observations[$index-1].test_name !== observation.test_name}">
          <div class="col-md-3">
            {# only show this if its not the same as the previous observation test name #}
            <span ng-show="!$index || labTest.observations[$index-1].test_name !== observation.test_name">
              [[ observation.test_name ]]
              <span ng-show="observation.units && observation.units.length">
                ([[ observation.units ]])
              </span>
              <span ng-show="observation.reference_range">
                range: [[ observation.reference_range ]]
              </span>
            </span>
          </div>
          <div class="col-md-3">
            [[ observation.date_ordered | shortDate ]]
          </div>
          <div class="col-md-3">
            [[ observation.observation_value ]]
          </div>
          <div ng-if="(!$index || labTest.observations[$index-1].test_name !== observation.test_name) && labTest.observation_time_series[observation.test_name].length" class="col-md-3">
            <div spark-line="labTest.observation_time_series[observation.test_name]"></div>
          </div>
        </div>
      </li>
    </ul>
  </div>
</div>
